>option timing 1
>option locking 1
>option semaphore 1
>proxy ./proxy
Proxy set up at bambooshark.ics.cs.cmu.edu:6727
>option stretch 200
>source '/afs/andrew.cmu.edu/usr3/yizhez/private/proxylab-s20-zhaoyizhe312/tests/D16-unique2.cmd'
># Make sure cache holds at most one copy of a binary file
>serve s1
Server s1 running at bambooshark.ics.cs.cmu.edu:26041
>generate random-binary00.bin 100K
>generate random-binary01.bin 100K
>generate random-binary02.bin 100K
>generate random-binary03.bin 100K
>generate random-binary04.bin 100K
>generate random-binary05.bin 100K
>generate random-binary06.bin 100K
>generate random-binary07.bin 100K
>generate random-binary08.bin 100K
>generate random-binary09.bin 100K
># Use 500K of cache
>fetch f00 random-binary00.bin s1
Client: Fetching '/random-binary00.bin' from bambooshark.ics.cs.cmu.edu:26041
>fetch f01 random-binary01.bin s1
Client: Fetching '/random-binary01.bin' from bambooshark.ics.cs.cmu.edu:26041
>fetch f02 random-binary02.bin s1
Client: Fetching '/random-binary02.bin' from bambooshark.ics.cs.cmu.edu:26041
>fetch f03 random-binary03.bin s1
Client: Fetching '/random-binary03.bin' from bambooshark.ics.cs.cmu.edu:26041
>fetch f04 random-binary04.bin s1
Client: Fetching '/random-binary04.bin' from bambooshark.ics.cs.cmu.edu:26041
>wait *
Proxy stderr: zyzyz: -1
Proxy stderr: GET /random-binary00.bin HTTP/1.0
Proxy stderr: Host: bambooshark.ics.cs.cmu.edu:26041
Proxy stderr: Request-ID: f00
Proxy stderr: Response: Immediate
Proxy stderr: User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:3.10.0) Gecko/20191101 Firefox/63.0.1
Proxy stderr: Connection: close
Proxy stderr: Proxy-Connection: close
Proxy stderr: 
Proxy stderr: zyzyz: -1
Proxy stderr: GET /random-binary01.bin HTTP/1.0
Proxy stderr: Host: bambooshark.ics.cs.cmu.edu:26041
Proxy stderr: Request-ID: f01
Proxy stderr: Response: Immediate
Proxy stderr: User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:3.10.0) Gecko/20191101 Firefox/63.0.1
Proxy stderr: Connection: close
Proxy stderr: Proxy-Connection: close
Proxy stderr: 
Proxy stderr: zyzyz: -1
Proxy stderr: GET /random-binary02.bin HTTP/1.0
Proxy stderr: Host: bambooshark.ics.cs.cmu.edu:26041
Proxy stderr: Request-ID: f02
Proxy stderr: Response: Immediate
Proxy stderr: User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:3.10.0) Gecko/20191101 Firefox/63.0.1
Proxy stderr: Connection: close
Proxy stderr: Proxy-Connection: close
Proxy stderr: 
Proxy stderr: zyzyz: -1
Proxy stderr: GET /random-binary04.bin HTTP/1.0
Proxy stderr: Host: bambooshark.ics.cs.cmu.edu:26041
Proxy stderr: Request-ID: f04
Proxy stderr: Response: Immediate
Proxy stderr: User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:3.10.0) Gecko/20191101 Firefox/63.0.1
Proxy stderr: Connection: close
Proxy stderr: Proxy-Connection: close
Proxy stderr: 
Proxy stderr: zyzyz: -1
Proxy stderr: GET /random-binary03.bin HTTP/1.0
Proxy stderr: Host: bambooshark.ics.cs.cmu.edu:26041
Proxy stderr: Request-ID: f03
Proxy stderr: Response: Immediate
Proxy stderr: User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:3.10.0) Gecko/20191101 Firefox/63.0.1
Proxy stderr: Connection: close
Proxy stderr: Proxy-Connection: close
Proxy stderr: 
Proxy stderr: large_flag: 0, size: 100194
Proxy stderr: left_size: 948382
Proxy stderr: large_flag: 0, size: 100194
Proxy stderr: left_size: 848188
Proxy stderr: large_flag: 0, size: 100194
Proxy stderr: large_flag: 0, size: 100194
Proxy stderr: left_size: 747994
Proxy stderr: left_size: 647800
Proxy stderr: large_flag: 0, size: 100194
Proxy stderr: left_size: 547606
># Make 5 requests, but defer responses
>request r05a random-binary05.bin s1
Client: Requesting '/random-binary05.bin' from bambooshark.ics.cs.cmu.edu:26041
>request r06a random-binary06.bin s1
Client: Requesting '/random-binary06.bin' from bambooshark.ics.cs.cmu.edu:26041
>request r07a random-binary07.bin s1
Client: Requesting '/random-binary07.bin' from bambooshark.ics.cs.cmu.edu:26041
>request r08a random-binary08.bin s1
Client: Requesting '/random-binary08.bin' from bambooshark.ics.cs.cmu.edu:26041
>request r09a random-binary09.bin s1
Client: Requesting '/random-binary09.bin' from bambooshark.ics.cs.cmu.edu:26041
>wait *
Proxy stderr: zyzyz: -1
Proxy stderr: GET /random-binary05.bin HTTP/1.0
Proxy stderr: Host: bambooshark.ics.cs.cmu.edu:26041
Proxy stderr: Request-ID: r05a
Proxy stderr: Response: Deferred
Proxy stderr: User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:3.10.0) Gecko/20191101 Firefox/63.0.1
Proxy stderr: Connection: close
Proxy stderr: Proxy-Connection: close
Proxy stderr: 
Proxy stderr: zyzyz: -1
Proxy stderr: GET /random-binary06.bin HTTP/1.0
Proxy stderr: Host: bambooshark.ics.cs.cmu.edu:26041
Proxy stderr: Request-ID: r06a
Proxy stderr: Response: Deferred
Proxy stderr: User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:3.10.0) Gecko/20191101 Firefox/63.0.1
Proxy stderr: Connection: close
Proxy stderr: Proxy-Connection: close
Proxy stderr: 
Proxy stderr: zyzyz: -1
Proxy stderr: GET /random-binary07.bin HTTP/1.0
Proxy stderr: Host: bambooshark.ics.cs.cmu.edu:26041
Proxy stderr: Request-ID: r07a
Proxy stderr: Response: Deferred
Proxy stderr: User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:3.10.0) Gecko/20191101 Firefox/63.0.1
Proxy stderr: Connection: close
Proxy stderr: Proxy-Connection: close
Proxy stderr: 
Proxy stderr: zyzyz: -1
Proxy stderr: GET /random-binary08.bin HTTP/1.0
Proxy stderr: Host: bambooshark.ics.cs.cmu.edu:26041
Proxy stderr: Request-ID: r08a
Proxy stderr: Response: Deferred
Proxy stderr: User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:3.10.0) Gecko/20191101 Firefox/63.0.1
Proxy stderr: Connection: close
Proxy stderr: Proxy-Connection: close
Proxy stderr: 
Proxy stderr: zyzyz: -1
Proxy stderr: GET /random-binary09.bin HTTP/1.0
Proxy stderr: Host: bambooshark.ics.cs.cmu.edu:26041
Proxy stderr: Request-ID: r09a
Proxy stderr: Response: Deferred
Proxy stderr: User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:3.10.0) Gecko/20191101 Firefox/63.0.1
Proxy stderr: Connection: close
Proxy stderr: Proxy-Connection: close
Proxy stderr: 
># Use 500K of cache, filling it up
>fetch f05 random-binary05.bin s1
Client: Fetching '/random-binary05.bin' from bambooshark.ics.cs.cmu.edu:26041
>fetch f06 random-binary06.bin s1
Client: Fetching '/random-binary06.bin' from bambooshark.ics.cs.cmu.edu:26041
>fetch f07 random-binary07.bin s1
Client: Fetching '/random-binary07.bin' from bambooshark.ics.cs.cmu.edu:26041
>fetch f08 random-binary08.bin s1
Client: Fetching '/random-binary08.bin' from bambooshark.ics.cs.cmu.edu:26041
>fetch f09 random-binary09.bin s1
Client: Fetching '/random-binary09.bin' from bambooshark.ics.cs.cmu.edu:26041
>wait *
Proxy stderr: zyzyz: -1
Proxy stderr: GET /random-binary05.bin HTTP/1.0
Proxy stderr: Host: bambooshark.ics.cs.cmu.edu:26041
Proxy stderr: Request-ID: f05
Proxy stderr: Response: Immediate
Proxy stderr: User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:3.10.0) Gecko/20191101 Firefox/63.0.1
Proxy stderr: Connection: close
Proxy stderr: Proxy-Connection: close
Proxy stderr: 
Proxy stderr: zyzyz: -1
Proxy stderr: GET /random-binary06.bin HTTP/1.0
Proxy stderr: Host: bambooshark.ics.cs.cmu.edu:26041
Proxy stderr: Request-ID: f06
Proxy stderr: Response: Immediate
Proxy stderr: User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:3.10.0) Gecko/20191101 Firefox/63.0.1
Proxy stderr: Connection: close
Proxy stderr: Proxy-Connection: close
Proxy stderr: 
Proxy stderr: zyzyz: -1
Proxy stderr: GET /random-binary07.bin HTTP/1.0
Proxy stderr: Host: bambooshark.ics.cs.cmu.edu:26041
Proxy stderr: Request-ID: f07
Proxy stderr: Response: Immediate
Proxy stderr: User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:3.10.0) Gecko/20191101 Firefox/63.0.1
Proxy stderr: Connection: close
Proxy stderr: Proxy-Connection: close
Proxy stderr: 
Proxy stderr: zyzyz: -1
Proxy stderr: GET /random-binary08.bin HTTP/1.0
Proxy stderr: Host: bambooshark.ics.cs.cmu.edu:26041
Proxy stderr: Request-ID: f08
Proxy stderr: Response: Immediate
Proxy stderr: User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:3.10.0) Gecko/20191101 Firefox/63.0.1
Proxy stderr: Connection: close
Proxy stderr: Proxy-Connection: close
Proxy stderr: 
Proxy stderr: zyzyz: -1
Proxy stderr: GET /random-binary09.bin HTTP/1.0
Proxy stderr: Host: bambooshark.ics.cs.cmu.edu:26041
Proxy stderr: Request-ID: f09
Proxy stderr: Response: Immediate
Proxy stderr: User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:3.10.0) Gecko/20191101 Firefox/63.0.1
Proxy stderr: Connection: close
Proxy stderr: Proxy-Connection: close
Proxy stderr: 
Proxy stderr: large_flag: 0, size: 100195
Proxy stderr: left_size: 447411
Proxy stderr: large_flag: 0, size: 100195
Proxy stderr: large_flag: 0, size: 100195
Proxy stderr: left_size: 347216
Proxy stderr: left_size: 247021
Proxy stderr: large_flag: 0, size: 100195
Proxy stderr: left_size: 146826
Proxy stderr: large_flag: 0, size: 100195
Proxy stderr: left_size: 46631
># These responses should not generate cache writes
># since the files were cached due to earlier fetches
># Out of order response will cause sequential proxy to fail
>respond r08a r09a r05a r06a r07a
Server responded to request r08a with status ok
Server responded to request r09a with status ok
Server responded to request r05a with status ok
Server responded to request r06a with status ok
Server responded to request r07a with status ok
>wait *
Proxy stderr: large_flag: 0, size: 100196
Proxy stderr: left_size: 46631
Proxy stderr: large_flag: 0, size: 100195
Proxy stderr: large_flag: 0, size: 100195
Proxy stderr: left_size: 46631
Proxy stderr: left_size: 46631
Proxy stderr: large_flag: 0, size: 100195
Proxy stderr: large_flag: 0, size: 100195
Proxy stderr: left_size: 46631
Proxy stderr: left_size: 46631
>check f00
Request f00 yielded expected status 'ok'
>check f01
Request f01 yielded expected status 'ok'
>check f02
Request f02 yielded expected status 'ok'
>check f03
Request f03 yielded expected status 'ok'
>check f04
Request f04 yielded expected status 'ok'
>check f05
Request f05 yielded expected status 'ok'
>check f06
Request f06 yielded expected status 'ok'
>check f07
Request f07 yielded expected status 'ok'
>check f08
Request f08 yielded expected status 'ok'
>check f09
Request f09 yielded expected status 'ok'
>check r05a
Request r05a yielded expected status 'ok'
>check r06a
Request r06a yielded expected status 'ok'
>check r07a
Request r07a yielded expected status 'ok'
>check r08a
Request r08a yielded expected status 'ok'
>check r09a
Request r09a yielded expected status 'ok'
># These should all hit the cache
>request r00b random-binary00.bin s1
Client: Requesting '/random-binary00.bin' from bambooshark.ics.cs.cmu.edu:26041
>request r01b random-binary01.bin s1
Client: Requesting '/random-binary01.bin' from bambooshark.ics.cs.cmu.edu:26041
>request r02b random-binary02.bin s1
Client: Requesting '/random-binary02.bin' from bambooshark.ics.cs.cmu.edu:26041
>request r03b random-binary03.bin s1
Client: Requesting '/random-binary03.bin' from bambooshark.ics.cs.cmu.edu:26041
>request r04b random-binary04.bin s1
Client: Requesting '/random-binary04.bin' from bambooshark.ics.cs.cmu.edu:26041
>request r05b random-binary05.bin s1
Client: Requesting '/random-binary05.bin' from bambooshark.ics.cs.cmu.edu:26041
>request r06b random-binary06.bin s1
Client: Requesting '/random-binary06.bin' from bambooshark.ics.cs.cmu.edu:26041
>request r07b random-binary07.bin s1
Client: Requesting '/random-binary07.bin' from bambooshark.ics.cs.cmu.edu:26041
>request r08b random-binary08.bin s1
Client: Requesting '/random-binary08.bin' from bambooshark.ics.cs.cmu.edu:26041
>request r09b random-binary09.bin s1
Client: Requesting '/random-binary09.bin' from bambooshark.ics.cs.cmu.edu:26041
>wait *
Proxy stderr: zyzyz: 1
Proxy stderr: zyzyz: 1
Proxy stderr: zyzyz: 1
Proxy stderr: zyzyz: 1
Proxy stderr: zyzyz: 1
Proxy stderr: zyzyz: 1
Proxy stderr: zyzyz: 1
Proxy stderr: zyzyz: 1
Proxy stderr: zyzyz: 1
Proxy stderr: zyzyz: 1
>check r00b
Request r00b yielded expected status 'ok'
>check r01b
Request r01b yielded expected status 'ok'
>check r02b
Request r02b yielded expected status 'ok'
>check r03b
Request r03b yielded expected status 'ok'
>check r04b
Request r04b yielded expected status 'ok'
>check r05b
Request r05b yielded expected status 'ok'
>check r06b
Request r06b yielded expected status 'ok'
>check r07b
Request r07b yielded expected status 'ok'
>check r08b
Request r08b yielded expected status 'ok'
>check r09b
Request r09b yielded expected status 'ok'
>delete random-binary00.bin
>delete random-binary01.bin
>delete random-binary02.bin
>delete random-binary03.bin
>delete random-binary04.bin
>delete random-binary05.bin
>delete random-binary06.bin
>delete random-binary07.bin
>delete random-binary08.bin
>delete random-binary09.bin
>quit
Testing done.  Elapsed time = 5.19 seconds
ALL TESTS PASSED
